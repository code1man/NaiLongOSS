<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.csu.demo.persistence.UserDao">
    <select id="findByUsername" resultType="org.csu.demo.domain.User">
            SELECT * FROM userinfo WHERE username = #{username}
    </select>

    <select id="getUserByUsernameAndPassword" resultType="org.csu.demo.domain.User">
        select * from userinfo where username = #{username} and password = #{password}
    </select>

    <!-- 查询所有用户，返回 List<User> -->
    <select id="getAllUsers" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo;
    </select>

    <!-- 通过 ID 查询单个用户 -->
    <select id="getUser" parameterType="int" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo WHERE id = #{id};
    </select>

    <!-- 添加用户 -->
    <insert id="addUser" parameterType="org.csu.demo.domain.User">
        INSERT INTO userinfo (username, password, email, age, responsibility)
        VALUES (#{username}, #{password}, #{email}, #{age}, #{responsibility});
    </insert>

    <!-- 更新用户信息 -->
    <update id="updateUser" parameterType="org.csu.demo.domain.User">
        UPDATE userinfo
        SET username = #{username},
            password = #{password},
            email = #{email},
            age = #{age}
        WHERE id = #{id};
    </update>

    <!-- 通过用户名查询用户 -->
    <select id="getUserByUsername" parameterType="string" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo WHERE username = #{username};
    </select>

    <!-- 通过id删除用户 -->
    <delete id="deleteUser" parameterType="int">
        DELETE FROM user WHERE id = #{id}
    </delete>

    <!-- 查询所有在线用户 -->
    <select id="getUserByIsOnlineTrue" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo WHERE isOnline = true;
    </select>

    <!-- 查询所有未在线用户 -->
    <select id="getUserByIsOnlineFalse" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo WHERE is_online = false;
    </select>

    <!-- 查询所有被冻结的用户 -->
    <select id="getUserByIsFrozenTrue" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo WHERE is_frozen = true;
    </select>

    <!-- 查询所有未冻结的用户 -->
    <select id="getUserByIsFrozenFalse" resultType="org.csu.demo.domain.User">
        SELECT * FROM userinfo WHERE is_frozen = false;
    </select>

    <!-- 查询用户人数 -->
    <select id="countAllUsers" resultType="int">
        SELECT COUNT(*) FROM userinfo;
    </select>
    
    <!-- 查询在线用户人数 -->
    <select id="countOnlineUsers" resultType="int">
        SELECT COUNT(*) FROM user_status WHERE is_online = true;
    </select>

    <!-- 冻结用户 -->
    <update id="freezeUser">
        UPDATE user SET is_frozen = 1 WHERE id = #{id},freeze_reason = #{reason} WHERE id = #{id}
    </update>

    <!-- 解冻用户 -->
    <update id="unfreezeUser" parameterType="int">
        UPDATE user SET is_frozen = 0 WHERE id = #{id}
    </update>

    <!-- 查询被冻结的用户人数 -->
    <select id="countFrozenUsers" resultType="int">
        SELECT COUNT(*) FROM user_status WHERE is_frozen = true;
    </select>

    <!-- 查询被冻结的用户原因 -->
    <select id="getFrozenReason" parameterType="int" resultType="string">
        SELECT frozen_reason FROM user_status WHERE id = #{id};
    </select>

</mapper>